<style>
  .search-btn {
    background-color: #f54284;
    color: #fff;
    border-radius: 25px;
    padding: 0 1rem 0 1rem;
  }
  .search-btn:hover {
    background-color: #f54284;
    color: #fff;
  }
  .search-btn i {
    display: inline;
    margin-right: 0.5rem;
  }

  .search-inp {
    border-radius: 25px;
    padding:  0.5rem 3rem 0.5rem 3rem;
    font-size: 1rem;
    transition: all 0.3s ease;
  }
  
  .search-inp.loading {
    opacity: 0.7;
    background-color: #f8f9fa;
  }
</style>

<nav class="navbar navbar-expand-md bg-body-light border-bottom sticky-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="/listings"><i class="fa-solid fa-hotel"></i></a>
      <button 
         class="navbar-toggler" 
         type="button" 
         data-bs-toggle="collapse" 
         data-bs-target="#navbarNavAltMarkup" 
        >
         <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav">
          <a class="nav-link site-logo" href="/listings">Stayozy</a>
        </div>

        <div class="navbar-nav ms-auto">
          <form class="d-flex" role="search" id="searchForm">
            <input 
              class="form-control me-2 search-inp" 
              type="search" 
              placeholder="Search destinations" 
              id="searchInput"
              name="query"
              required
            />
            <button class="btn search-btn" type="submit">
              <i class="fa-solid fa-magnifying-glass"></i>Search
            </button>
          </form>
        </div>

        <div class="navbar-nav ms-auto">
          <a class="nav-link" href="/listings/new">Become a host</a>
          <% if (!locals.currUser) { %>
          <a class="nav-link" href="/signup"><b>Sign up</b></a>
          <a class="nav-link" href="/login"><b>Log in </b></a>
          <% } %> <% if (locals.currUser) { %>
          <a class="nav-link" href="/logout"><b>Log out</b></a>
          <% } %> 
        </div>
      </div>
    </div>
</nav>

<style>
.site-logo {
  font-size: 1.6rem;
  font-weight: 700;
  color: #f54284 !important; /* matches your button color */
  display: flex;
  align-items: center;
  gap: 0.5rem;
  text-decoration: none;
}

.site-logo span {
  font-family: 'Poppins', sans-serif; /* or another modern font */
  letter-spacing: 1px;
}

.site-logo:hover {
  color: #d6336c !important; /* darker shade on hover */
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchForm = document.getElementById('searchForm');
    const searchInput = document.getElementById('searchInput');
    
    if (searchForm) {
        searchForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const query = searchInput.value.trim();
            if (!query) {
                alert('Please enter a search term');
                return;
            }
            
            try {
                // Show loading state
                const submitBtn = searchForm.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>Searching...';
                submitBtn.disabled = true;
                
                // Add loading class to search input
                searchInput.classList.add('loading');
                
                // Make API call to search endpoint
                const response = await fetch(`/listings/search?query=${encodeURIComponent(query)}`);
                const data = await response.json();
                
                if (data.success) {
                    // Redirect to listings page with search results
                    window.location.href = `/listings?search=${encodeURIComponent(query)}&results=${data.listings.length}`;
                } else {
                    alert(data.message || 'Search failed. Please try again.');
                }
                
            } catch (error) {
                console.error('Search error:', error);
                alert('An error occurred while searching. Please try again.');
            } finally {
                // Reset button state
                const submitBtn = searchForm.querySelector('button[type="submit"]');
                submitBtn.innerHTML = '<i class="fa-solid fa-magnifying-glass"></i>Search';
                submitBtn.disabled = false;
                
                // Remove loading class from search input
                searchInput.classList.remove('loading');
            }
        });
    }
});
</script>